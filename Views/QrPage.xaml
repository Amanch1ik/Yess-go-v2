<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="YessGoFront.Views.QrPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Shell.NavBarIsVisible="False"
    BackgroundColor="#ECECEC">

    <!-- Вся страница разбита на 3 строки:
         0: шапка
         1: камера + маска + описание + фонарик
         2: нижние кнопки -->
    <Grid RowDefinitions="Auto,*,Auto"
          BackgroundColor="#ECECEC">

        <!-- ====== ШАПКА (тёмно-зелёная) ====== -->
        <Grid Grid.Row="0"
              BackgroundColor="#004D3A"
              Padding="16,16,16,12"
              ColumnDefinitions="Auto,*">

            <!-- Кнопка Назад -->
            <Grid Grid.Column="0">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnBackTapped"/>
                </Grid.GestureRecognizers>

                <HorizontalStackLayout Spacing="6"
                                       VerticalOptions="Center">
                    <Image Source="icon_back.png"
                           WidthRequest="20"
                           HeightRequest="20"
                           Aspect="AspectFit"/>
                    <Label Text="Назад"
                           TextColor="White"
                           FontSize="14"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Grid>

            <!-- Пустышка справа (на макете пусто) -->
            <Grid Grid.Column="1"/>
        </Grid>

        <!-- ====== ТЕЛО (камера + маска + описание + фонарик) ====== -->
        <Grid Grid.Row="1"
              BackgroundColor="#ECECEC"
              Padding="16,24,16,16"
              RowDefinitions="*,Auto">

            <!-- 1) Камера + затемнение + зелёные углы -->
            <Grid Grid.Row="0">

                <!-- прехолдер камеры.
                     позже заменишь на CameraView (ZXing / Toolkit) -->
                <Grid x:Name="CameraPreview"
                      BackgroundColor="#DADADA"
                      HorizontalOptions="Fill"
                      VerticalOptions="Fill"/>

                <!-- МАСКА -->
                <Grid>
                    <!-- затемнение по всей области -->
                    <BoxView Color="#55000000"/>

                    <!-- окно-сканер по центру -->
                    <Grid WidthRequest="240"
                          HeightRequest="240"
                          HorizontalOptions="Center"
                          VerticalOptions="Center">

                        <!-- Просто прозрачный прямоугольник,
                             создающий "дырку" визуально -->
                        <Frame BackgroundColor="Transparent"
                               HasShadow="False"
                               BorderColor="Transparent"
                               CornerRadius="12"/>

                        <!-- Угловые скобки -->
                        <Grid>
                            <!-- Левый верх -->
                            <Grid HorizontalOptions="Start"
                                  VerticalOptions="Start"
                                  WidthRequest="60"
                                  HeightRequest="60">
                                <BoxView Color="#005C3F"
                                         WidthRequest="40"
                                         HeightRequest="4"
                                         HorizontalOptions="Start"
                                         VerticalOptions="Start"
                                         CornerRadius="2"/>
                                <BoxView Color="#005C3F"
                                         WidthRequest="4"
                                         HeightRequest="40"
                                         HorizontalOptions="Start"
                                         VerticalOptions="Start"
                                         CornerRadius="2"/>
                            </Grid>

                            <!-- Правый верх -->
                            <Grid HorizontalOptions="End"
                                  VerticalOptions="Start"
                                  WidthRequest="60"
                                  HeightRequest="60">
                                <BoxView Color="#005C3F"
                                         WidthRequest="40"
                                         HeightRequest="4"
                                         HorizontalOptions="End"
                                         VerticalOptions="Start"
                                         CornerRadius="2"/>
                                <BoxView Color="#005C3F"
                                         WidthRequest="4"
                                         HeightRequest="40"
                                         HorizontalOptions="End"
                                         VerticalOptions="Start"
                                         CornerRadius="2"/>
                            </Grid>

                            <!-- Левый низ -->
                            <Grid HorizontalOptions="Start"
                                  VerticalOptions="End"
                                  WidthRequest="60"
                                  HeightRequest="60">
                                <BoxView Color="#005C3F"
                                         WidthRequest="40"
                                         HeightRequest="4"
                                         HorizontalOptions="Start"
                                         VerticalOptions="End"
                                         CornerRadius="2"/>
                                <BoxView Color="#005C3F"
                                         WidthRequest="4"
                                         HeightRequest="40"
                                         HorizontalOptions="Start"
                                         VerticalOptions="End"
                                         CornerRadius="2"/>
                            </Grid>

                            <!-- Правый низ -->
                            <Grid HorizontalOptions="End"
                                  VerticalOptions="End"
                                  WidthRequest="60"
                                  HeightRequest="60">
                                <BoxView Color="#005C3F"
                                         WidthRequest="40"
                                         HeightRequest="4"
                                         HorizontalOptions="End"
                                         VerticalOptions="End"
                                         CornerRadius="2"/>
                                <BoxView Color="#005C3F"
                                         WidthRequest="4"
                                         HeightRequest="40"
                                         HorizontalOptions="End"
                                         VerticalOptions="End"
                                         CornerRadius="2"/>
                            </Grid>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>

            <!-- 2) Подпись и фонарик -->
            <VerticalStackLayout Grid.Row="1"
                                 Spacing="24"
                                 Padding="0,24,0,0">

                <!-- Текст под сканером -->
                <VerticalStackLayout Spacing="6"
                                     HorizontalOptions="Center">
                    <Label Text="Сканируйте QR код"
                           FontAttributes="Bold"
                           TextColor="#2F2F2F"
                           FontSize="16"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="Отсканируйте чек, чтобы получить"
                           TextColor="#4A4A4A"
                           FontSize="13"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="бонусные баллы"
                           TextColor="#4A4A4A"
                           FontSize="13"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Фонарик -->
                <Grid ColumnDefinitions="*,Auto"
                      Padding="16,0,16,0"
                      VerticalOptions="Center">
                    <!-- слайдер яркости фонаря -->
                    <Slider x:Name="TorchSlider"
                            Grid.Column="0"
                            Minimum="0"
                            Maximum="1"
                            MinimumTrackColor="#0F6B53"
                            MaximumTrackColor="#999999"
                            ThumbColor="#0F6B53"
                            ValueChanged="OnTorchSliderChanged" />

                    <!-- иконка фонарика -->
                    <Image Grid.Column="1"
                           Source="icon_flash.png"
                           WidthRequest="24"
                           HeightRequest="24"
                           VerticalOptions="Center"
                           HorizontalOptions="End">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFlashTapped"/>
                        </Image.GestureRecognizers>
                    </Image>
                </Grid>

            </VerticalStackLayout>
        </Grid>

        <!-- ====== НИЖНИЕ КНОПКИ ("Мой QR" / "Из Галереи") ====== -->
        <Grid Grid.Row="2"
              Padding="16,0,16,24"
              BackgroundColor="Transparent"
              ColumnDefinitions="*,*"
              ColumnSpacing="12">

            <!-- Мой QR -->
            <Frame Grid.Column="0"
                   Padding="12,10"
                   BackgroundColor="#EFEFEF"
                   HasShadow="False"
                   BorderColor="#CCCCCC"
                   CornerRadius="10">
                <Grid ColumnDefinitions="Auto,*"
                      ColumnSpacing="8">
                    <Image Source="icon_myqr.png"
                           WidthRequest="20"
                           HeightRequest="20"
                           VerticalOptions="Center"/>
                    <Label Text="Мой QR"
                           VerticalOptions="Center"
                           FontSize="14"
                           TextColor="#1A1A1A"/>
                </Grid>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnMyQrTapped"/>
                </Frame.GestureRecognizers>
            </Frame>

            <!-- Из галереи -->
            <Frame Grid.Column="1"
                   Padding="12,10"
                   BackgroundColor="#EFEFEF"
                   HasShadow="False"
                   BorderColor="#CCCCCC"
                   CornerRadius="10">
                <Grid ColumnDefinitions="Auto,*"
                      ColumnSpacing="8">
                    <Image Source="icon_gallery.png"
                           WidthRequest="20"
                           HeightRequest="20"
                           VerticalOptions="Center"/>
                    <Label Text="Из Галереи"
                           VerticalOptions="Center"
                           FontSize="14"
                           TextColor="#1A1A1A"/>
                </Grid>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnGalleryTapped"/>
                </Frame.GestureRecognizers>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
